<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stimulus Reactive UI</title>

    <!-- Tailwind CSS via Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Import Maps for Stimulus -->
    <script type="importmap">
      {
        "imports": {
          "@hotwired/stimulus": "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"
        }
      }
    </script>
  </head>
  <body class="bg-gray-100 min-h-screen pt-12 pb-24">
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-8">Stimulus Reactive UI</h1>

        <!-- 1. Interactive Counter -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#interactive-counter" id="interactive-counter" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >1. Interactive Counter</a
          >
          <div data-controller="live">
            <!-- State States -->
            <input type="hidden" data-live-state="count" value="0" />
            <input type="hidden" data-live-state="totalClicks" value="0" />
            <input type="hidden" data-live-state="stepSize" value="5" />

            <!-- Computed States -->
            <script type="text/template" data-live-computed="absMax">
              42
            </script>
            <script type="text/template" data-live-computed="isNegative">
              state.count < 0
            </script>
            <script type="text/template" data-live-computed="isPositive">
              state.count > 0
            </script>
            <script type="text/template" data-live-computed="isZero">
              state.count === 0
            </script>
            <script type="text/template" data-live-computed="absCount">
              Math.abs(state.count)
            </script>
            <script type="text/template" data-live-computed="countCategory">
              state.count === 0 ? 'neutral' :
              state.count > 0 && state.count <= 10 ? 'small-positive' :
              state.count > 10 ? 'large-positive' :
              state.count < 0 && state.count >= -10 ? 'small-negative' :
              'large-negative'
            </script>
            <script type="text/template" data-live-computed="progressWidth">
              Math.min(100, (computed.absCount / computed.absMax) * 100)
            </script>
            <script type="text/template" data-live-computed="canDecrement">
              state.count > -computed.absMax
            </script>
            <script type="text/template" data-live-computed="canIncrement">
              state.count < computed.absMax
            </script>

            <!-- Step Size Selector -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Step Size</label>
              <div class="flex gap-2">
                <button
                  data-action="click->live#update"
                  data-live-update-param="state.stepSize = 1"
                  class="px-3 py-1 text-sm rounded transition-colors"
                  live:class="{
                    'bg-blue-600 text-white': state.stepSize === 1,
                    'bg-gray-200 text-gray-700 hover:bg-gray-300': state.stepSize !== 1
                  }"
                >
                  1x
                </button>
                <button
                  data-action="click->live#update"
                  data-live-update-param="state.stepSize = 5"
                  class="px-3 py-1 text-sm rounded transition-colors"
                  live:class="{
                    'bg-blue-600 text-white': state.stepSize === 5,
                    'bg-gray-200 text-gray-700 hover:bg-gray-300': state.stepSize !== 5
                  }"
                >
                  5x
                </button>
                <button
                  data-action="click->live#update"
                  data-live-update-param="state.stepSize = 10"
                  class="px-3 py-1 text-sm rounded transition-colors"
                  live:class="{
                    'bg-blue-600 text-white': state.stepSize === 10,
                    'bg-gray-200 text-gray-700 hover:bg-gray-300': state.stepSize !== 10
                  }"
                >
                  10x
                </button>
              </div>
            </div>

            <!-- Main Counter Display -->
            <div class="text-center mb-6">
              <div
                class="inline-block text-6xl font-bold p-6 rounded-2xl transition-all duration-300 transform"
                live:class="{
                  'text-gray-600 bg-gray-100 scale-100': computed.isZero,
                  'text-green-600 bg-green-100 scale-105': computed.countCategory === 'small-positive',
                  'text-green-700 bg-green-200 scale-110': computed.countCategory === 'large-positive',
                  'text-red-600 bg-red-100 scale-105': computed.countCategory === 'small-negative',
                  'text-red-700 bg-red-200 scale-110': computed.countCategory === 'large-negative'
                }"
                live:text="state.count"
              >
                0
              </div>

              <!-- Progress Bar -->
              <div class="mt-4 max-w-md mx-auto">
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                  <span live:text="`-${computed.absMax}`"></span>
                  <span live:text="`Progress: ${computed.absCount}/${computed.absMax}`"></span>
                  <span live:text="`+${computed.absMax}`"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div
                    class="h-2 rounded-full transition-all duration-300"
                    live:class="{
                      'bg-green-500': computed.isPositive,
                      'bg-red-500': computed.isNegative,
                      'bg-gray-400': computed.isZero
                    }"
                    live:style="{ width: computed.progressWidth + '%' }"
                  ></div>
                </div>
              </div>
            </div>

            <!-- Counter Controls -->
            <div class="flex justify-center gap-4 mb-6">
              <button
                data-action="click->live#update"
                data-live-update-param="state.count = Math.max(-computed.absMax, state.count - state.stepSize), state.totalClicks++"
                live:disabled="!computed.canDecrement"
                class="flex items-center gap-2 px-6 py-3 text-lg font-semibold rounded-lg transform hover:scale-105 disabled:hover:scale-100"
                live:class="{
                  'bg-red-500 hover:bg-red-600 text-white shadow-lg': computed.canDecrement,
                  'bg-gray-300 text-gray-500 cursor-not-allowed': !computed.canDecrement
                }"
              >
                <span class="text-xl">−</span>
                <span live:text="state.stepSize">1</span>
              </button>

              <button
                data-action="click->live#update"
                data-live-update-param="state.count = 0, state.totalClicks++"
                class="px-6 py-3 text-lg font-semibold bg-gray-500 hover:bg-gray-600 text-white rounded-lg transform hover:scale-105"
              >
                Reset
              </button>

              <button
                data-action="click->live#update"
                data-live-update-param="state.count = Math.min(computed.absMax, state.count + state.stepSize), state.totalClicks++"
                live:disabled="!computed.canIncrement"
                class="flex items-center gap-2 px-6 py-3 text-lg font-semibold rounded-lg transform hover:scale-105 disabled:hover:scale-100"
                live:class="{
                  'bg-green-500 hover:bg-green-600 text-white shadow-lg': computed.canIncrement,
                  'bg-gray-300 text-gray-500 cursor-not-allowed': !computed.canIncrement
                }"
              >
                <span class="text-xl">+</span>
                <span live:text="state.stepSize">1</span>
              </button>
            </div>

            <!-- Analytics Panel -->
            <div class="grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg">
              <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" live:text="state.totalClicks">0</div>
                <div class="text-sm text-gray-600">Total Clicks</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" live:text="computed.progressWidth.toFixed(0) + '%'">0</div>
                <div class="text-sm text-gray-600">Progress</div>
              </div>
              <div class="text-center">
                <div
                  class="text-2xl font-bold"
                  live:class="{
                    'text-green-600': computed.isPositive,
                    'text-red-600': computed.isNegative,
                    'text-gray-600': computed.isZero
                  }"
                  live:text="computed.isPositive ? 'Positive' : (computed.isNegative ? 'Negative' : 'Neutral')"
                >
                  Neutral
                </div>
                <div class="text-sm text-gray-600">Current State</div>
              </div>
            </div>

            <!-- Status Messages -->
            <div class="mt-4 space-y-2">
              <div
                class="text-sm bg-yellow-100 text-yellow-800 border border-yellow-200 p-3 rounded-lg"
                live:show="computed.absCount >= 25 && computed.absCount < 35"
                style="display: none"
              >
                <span class="pr-1">⚡️</span> You're getting close to the limits, keep going!
              </div>

              <div
                class="text-sm bg-orange-100 text-orange-800 border border-orange-200 p-3 rounded-lg"
                live:show="computed.absCount >= 35 && computed.absCount < computed.absMax"
                style="display: none"
              >
                <span class="pr-1">🔥</span> Close to the ultimate number, almost there!
              </div>

              <div
                class="text-sm p-3 rounded-lg bg-green-100 text-green-800 border border-green-200"
                live:show="state.count === computed.absMax"
                style="display: none"
              >
                <span class="pr-1">🎉</span> The answer to the ultimate question of life, the universe, and everything!
              </div>

              <div
                class="text-sm p-3 rounded-lg bg-blue-100 text-blue-800 border border-blue-200"
                live:show="state.totalClicks > 0 && state.count === 0"
                style="display: none"
              >
                <span class="pr-1">🎯</span> Back to the beginning! You've used up <span live:text="state.totalClicks">0</span> clicks
                total.
              </div>
            </div>
          </div>
        </div>

        <!-- 2. Progress Bar with Status -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#progress-bar" id="progress-bar" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >2. Progress Bar with Status</a
          >
          <div data-controller="live">
            <input type="range" data-live-state="progress" min="0" max="100" value="25" class="hidden" />
            <script type="text/template" data-live-computed="progressPercentageColor">
              {
                "text-red-600": state.progress < 30,
                "text-yellow-600": state.progress >= 30 && state.progress < 70,
                "text-green-600": state.progress >= 70,
              }
            </script>
            <script type="text/template" data-live-computed="progressBarColor">
              {
                "bg-red-600": state.progress < 30,
                "bg-yellow-600": state.progress >= 30 && state.progress < 70,
                "bg-green-600": state.progress >= 70,
              }
            </script>
            <script type="text/template" data-live-computed="canDecrease">
              state.progress > 0
            </script>
            <script type="text/template" data-live-computed="canIncrease">
              state.progress < 100
            </script>

            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-gray-700">Progress:</span>
              <span live:text="state.progress + '%'" live:class="computed.progressPercentageColor" class="text-sm font-bold"></span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
              <div
                live:class="computed.progressBarColor"
                class="h-4 rounded-full transition-all duration-150"
                live:style="{ width: state.progress + '%' }"
              ></div>
            </div>
            <div class="flex gap-2">
              <button
                data-action="click->live#update"
                data-live-update-param="state.progress = Math.max(0, state.progress - 10)"
                live:disabled="!computed.canDecrease"
                class="bg-red-500 text-white hover:bg-red-600 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed px-3 py-1 rounded text-sm transition-colors"
              >
                -10%
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.progress = Math.min(100, state.progress + 10)"
                live:disabled="!computed.canIncrease"
                class="bg-green-500 text-white hover:bg-green-600 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed px-3 py-1 rounded text-sm transition-colors"
              >
                +10%
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.progress = 25"
                class="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600"
              >
                Reset
              </button>
            </div>
          </div>
        </div>

        <!-- 3. Shopping Cart Calculator -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#shopping-cart" id="shopping-cart" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >3. Shopping Cart Calculator</a
          >
          <div data-controller="live">
            <script type="text/template" data-live-computed="subtotal">
              state.quantity * state.price;
            </script>
            <script type="text/template" data-live-computed="discountAmount">
              (computed.subtotal * state.discount) / 100;
            </script>
            <script type="text/template" data-live-computed="total">
              computed.subtotal - computed.discountAmount;
            </script>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                <input
                  type="number"
                  min="1"
                  value="1"
                  data-live-state="quantity"
                  data-action="input->live#update"
                  class="w-full p-2 border border-gray-300 rounded"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Price per item</label>
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  value="29.99"
                  data-live-state="price"
                  data-action="input->live#update"
                  class="w-full p-2 border border-gray-300 rounded"
                />
              </div>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Discount (%)</label>
              <input type="range" min="0" max="50" value="0" data-live-state="discount" data-action="input->live#update" class="w-full" />
              <div class="text-center text-sm text-gray-600 mt-1" live:text="state.discount + '% off'">0% off</div>
            </div>
            <div class="bg-gray-50 p-4 rounded">
              <div class="flex justify-between items-center text-sm text-gray-600 mb-1">
                <span>Subtotal:</span>
                <span live:text="'$' + computed.subtotal.toFixed(2)">$29.99</span>
              </div>
              <div class="flex justify-between items-center text-sm text-gray-600 mb-1">
                <span>Discount:</span>
                <span live:text="'-$' + computed.discountAmount.toFixed(2)">-$0.00</span>
              </div>
              <div class="flex justify-between items-center text-lg font-bold text-gray-800 border-t pt-2">
                <span>Total:</span>
                <span live:text="'$' + computed.total.toFixed(2)">$29.99</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 4. Theme Switcher -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#theme-switcher" id="theme-switcher" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >4. Theme Switcher</a
          >
          <div data-controller="live">
            <script type="text/template" data-live-computed="previewClasses">
              { 'p-4 rounded transition-all duration-150': true, 'text-sm': state.fontSize === 'small', 'text-base': state.fontSize === 'medium', 'text-lg': state.fontSize === 'large' }
            </script>

            <script type="text/template" data-live-computed="themeTitle">
              state.theme.charAt(0).toUpperCase() + state.theme.slice(1)
            </script>

            <script type="text/template" data-live-computed="previewHtml">
              <h3 class="font-bold mb-2">${computed.themeTitle} theme</h3>
              <p>This is what your content will look like with the selected theme and font size.</p>
            </script>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="theme"
                      value="light"
                      data-live-state="theme"
                      data-action="change->live#update"
                      class="mr-2"
                      checked
                    />
                    Light
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="theme" value="dark" data-live-state="theme" data-action="change->live#update" class="mr-2" />
                    Dark
                  </label>
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="theme"
                      value="colorful"
                      data-live-state="theme"
                      data-action="change->live#update"
                      class="mr-2"
                    />
                    Colorful
                  </label>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Font Size</label>
                <select data-live-state="fontSize" data-action="change->live#update" class="w-full p-2 border border-gray-300 rounded">
                  <option value="small">Small</option>
                  <option value="medium" selected>Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>
            </div>
            <div
              class="bg-gray-50 text-gray-800"
              live:class="computed.previewClasses"
              live:show="state.theme === 'light'"
              live:html="computed.previewHtml"
            ></div>
            <div
              class="bg-gray-800 border-gray-600 text-gray-100"
              live:class="computed.previewClasses"
              live:show="state.theme === 'dark'"
              live:html="computed.previewHtml"
            ></div>
            <div
              class="bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 text-white"
              live:class="computed.previewClasses"
              live:show="state.theme === 'colorful'"
              live:html="computed.previewHtml"
            ></div>
          </div>
        </div>

        <!-- 5. Stateful Accordion -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#stateful-accordion" id="stateful-accordion" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >5. Stateful Accordion</a
          >
          <div data-controller="live">
            <!-- Hidden input to track which panel is open -->
            <input type="hidden" data-live-state="openPanel" value="" data-action="input->live#update" />

            <!-- Panel 1 -->
            <div class="border border-gray-200 rounded-lg mb-2">
              <button
                class="w-full px-4 py-3 text-left font-medium text-gray-800 hover:bg-gray-50 rounded-t-lg flex justify-between items-center"
                data-action="click->live#update"
                data-live-update-param="state.openPanel = state.openPanel === 'panel1' ? '' : 'panel1'"
                live:class="{ 'bg-blue-50 border-b border-gray-200': state.openPanel === 'panel1' }"
              >
                <span>What is Stimulus?</span>
                <svg
                  class="w-5 h-5 transition-transform duration-150"
                  live:class="{ 'rotate-180': state.openPanel === 'panel1' }"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="overflow-hidden transition-all duration-150" live:class="{ 'hidden': state.openPanel !== 'panel1' }">
                <div class="p-4 text-gray-600">
                  Stimulus is a JavaScript framework with modest ambitions. It doesn't seek to take over your entire front-end—in fact, it's
                  not concerned with rendering HTML at all. Instead, it's designed to augment your HTML with just enough behavior to make it
                  shine.
                </div>
              </div>
            </div>

            <!-- Panel 2 -->
            <div class="border border-gray-200 rounded-lg mb-2">
              <button
                class="w-full px-4 py-3 text-left font-medium text-gray-800 hover:bg-gray-50 rounded-t-lg flex justify-between items-center"
                data-action="click->live#update"
                data-live-update-param="state.openPanel = state.openPanel === 'panel2' ? '' : 'panel2'"
                live:class="{ 'bg-blue-50 border-b border-gray-200': state.openPanel === 'panel2' }"
              >
                <span>How does data binding work?</span>
                <svg
                  class="w-5 h-5 transition-transform duration-150"
                  live:class="{ 'rotate-180': state.openPanel === 'panel2' }"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="overflow-hidden transition-all duration-150" live:class="{ 'hidden': state.openPanel !== 'panel2' }">
                <div class="p-4 text-gray-600">
                  Data binding allows you to automatically sync your application state with the DOM. When state changes, the UI updates
                  automatically without manual DOM manipulation. This creates reactive interfaces with minimal code.
                </div>
              </div>
            </div>

            <!-- Panel 3 -->
            <div class="border border-gray-200 rounded-lg mb-2">
              <button
                class="w-full px-4 py-3 text-left font-medium text-gray-800 hover:bg-gray-50 rounded-t-lg flex justify-between items-center"
                data-action="click->live#update"
                data-live-update-param="state.openPanel = state.openPanel === 'panel3' ? '' : 'panel3'"
                live:class="{ 'bg-blue-50 border-b border-gray-200': state.openPanel === 'panel3' }"
              >
                <span>Why use this approach?</span>
                <svg
                  class="w-5 h-5 transition-transform duration-150"
                  live:class="{ 'rotate-180': state.openPanel === 'panel3' }"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="overflow-hidden transition-all duration-150" live:class="{ 'hidden': state.openPanel !== 'panel3' }">
                <div class="p-4 text-gray-600">
                  This approach provides a clean separation between state and presentation. It's declarative, easy to understand, and
                  reduces the complexity of managing UI state. Plus, it works great with server-rendered HTML!
                </div>
              </div>
            </div>

            <!-- Status indicator -->
            <div class="mt-4 text-sm text-gray-500 text-center">
              Currently open:
              <span live:text="state.openPanel || 'None'">None</span>
            </div>
          </div>
        </div>

        <!-- 6. Live Search Results -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#live-search" id="live-search" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >6. Live Search Results</a
          >
          <div data-controller="live">
            <script type="text/template" data-live-computed="items">
              ['Apple', 'Banana', 'Cherry', 'Date', 'Elderberry', 'Fig', 'Grape']
            </script>
            <script type="text/template" data-live-computed="hasQuery">
              state.query !== ''
            </script>
            <script type="text/template" data-live-computed="filteredResults">
              computed.items.filter(item => item.toLowerCase().includes(state.query.toLowerCase()))
            </script>
            <script type="text/template" data-live-computed="resultsText">
              computed.hasQuery ? computed.filteredResults.length + ' results found' : computed.items.length + ' items available'
            </script>
            <script type="text/template" data-live-computed="hasNoResults">
              computed.hasQuery && computed.filteredResults.length === 0
            </script>
            <script type="text/template" data-live-computed="itemsHtml">
              computed.filteredResults.map(item => `
                <div class="p-2 bg-gray-50 rounded border-l-4 ${computed.hasQuery ? 'border-blue-500' : 'border-gray-300'}">
                  ${item}
                </div>
              `).join('')
            </script>

            <input
              type="text"
              placeholder="Search fruits..."
              value=""
              data-live-state="query"
              data-action="input->live#update"
              class="w-full p-3 border border-gray-300 rounded-lg mb-4"
            />

            <!-- Results counter -->
            <div class="text-sm text-gray-600 mb-2">
              <span live:text="computed.resultsText">7 items available</span>
            </div>

            <!-- Results list -->
            <div class="space-y-2" live:html="computed.itemsHtml"></div>

            <!-- No results message -->
            <div live:show="computed.hasNoResults">
              <p class="text-center text-gray-500 mt-4">No results found for "<span live:text="state.query"></span>"</p>
            </div>
          </div>
        </div>

        <!-- 7. Character Counter & Text Analysis -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#character-counter" id="character-counter" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >7. Character Counter & Text Analysis</a
          >
          <div data-controller="live">
            <!-- Computed States Templates -->
            <script type="text/template" data-live-computed="lineCount">
              state.text.split('\n').length
            </script>
            <script type="text/template" data-live-computed="wordCount">
              state.text.trim().split(/\s+/).filter(word => word.length > 0).length
            </script>
            <script type="text/template" data-live-computed="readingTime">
              Math.ceil(computed.wordCount / 200)
            </script>
            <script type="text/template" data-live-computed="usagePercentage">
              Math.round((state.text.length / state.maxLength) * 100)
            </script>
            <script type="text/template" data-live-computed="isOverLimit">
              state.text.length > state.maxLength
            </script>
            <script type="text/template" data-live-computed="isNearLimit">
              state.text.length > state.maxLength * 0.8 && state.text.length <= state.maxLength
            </script>
            <script type="text/template" data-live-computed="isComfortable">
              state.text.length > 0 && state.text.length <= state.maxLength * 0.8
            </script>
            <script type="text/template" data-live-computed="isEmpty">
              state.text.length === 0
            </script>
            <script type="text/template" data-live-computed="isHalfway">
              state.text.length > 0 && state.text.length <= state.maxLength * 0.5
            </script>

            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Max characters allowed</label>
              <input
                type="range"
                min="50"
                max="500"
                step="10"
                data-live-state="maxLength"
                data-action="input->live#update"
                class="w-full"
              />
              <div class="text-center text-sm text-gray-600 mt-1" live:text="state.maxLength + ' characters max'">280 characters max</div>
            </div>

            <div class="relative">
              <textarea
                placeholder="Start typing your message..."
                data-live-state="text"
                data-action="input->live#update"
                live:class="{
                  'border-red-500 bg-red-50': computed.isOverLimit,
                  'border-yellow-500 bg-yellow-50': computed.isNearLimit,
                  'border-green-500 bg-green-50': computed.isComfortable
                }"
                class="w-full p-3 border border-gray-300 rounded-lg resize-none h-32 transition-colors"
              >
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus laoreet elit efficitur, feugiat ex vitae, auctor ex. Sed mollis diam et mollis volutpat.</textarea
              >

              <!-- Character count overlay -->
              <div
                class="absolute bottom-3 right-3 px-2 py-1 rounded text-xs font-medium text-white"
                live:class="{
                  'bg-red-600': computed.isOverLimit,
                  'bg-yellow-600': computed.isNearLimit,
                  'bg-green-600': computed.isComfortable,
                  'bg-gray-500': computed.isEmpty
                }"
                live:text="state.text.length + '/' + state.maxLength"
              >
                0/280
              </div>
            </div>

            <!-- Text Statistics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
              <div class="bg-gray-50 p-3 rounded text-center">
                <div class="text-lg font-bold text-gray-800" live:text="state.text.length">0</div>
                <div class="text-sm text-gray-600">Characters</div>
              </div>
              <div class="bg-gray-50 p-3 rounded text-center">
                <div class="text-lg font-bold text-gray-800" live:text="computed.wordCount">0</div>
                <div class="text-sm text-gray-600">Words</div>
              </div>
              <div class="bg-gray-50 p-3 rounded text-center">
                <div class="text-lg font-bold text-gray-800" live:text="computed.lineCount">1</div>
                <div class="text-sm text-gray-600">Lines</div>
              </div>
              <div class="bg-gray-50 p-3 rounded text-center">
                <div class="text-lg font-bold text-gray-800" live:text="computed.readingTime">0</div>
                <div class="text-sm text-gray-600">Est. Reading (min)</div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mt-4">
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Usage:</span>
                <span
                  class="text-sm font-bold"
                  live:class="{
                    'text-red-600': computed.isOverLimit,
                    'text-yellow-600': computed.isNearLimit,
                    'text-green-600': !computed.isOverLimit && !computed.isNearLimit
                  }"
                  live:text="computed.usagePercentage + '%'"
                >
                  0%
                </span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div
                  class="h-3 rounded-full transition-all duration-150"
                  live:class="{
                    'bg-red-500': computed.isOverLimit,
                    'bg-yellow-500': computed.isNearLimit,
                    'bg-green-500': !computed.isOverLimit && !computed.isNearLimit
                  }"
                  live:style="{ width: Math.min(100, computed.usagePercentage) + '%' }"
                ></div>
              </div>
            </div>

            <!-- Status Messages -->
            <div class="mt-4 space-y-2">
              <div
                class="text-sm p-2 rounded"
                live:class="{
                  'hidden': !computed.isOverLimit,
                  'bg-red-100 text-red-700 border border-red-200': computed.isOverLimit
                }"
              >
                ⚠️ You've exceeded the character limit by
                <span live:text="Math.max(0, state.text.length - state.maxLength)">0</span> characters.
              </div>
              <div
                class="text-sm p-2 rounded"
                live:class="{
                  'hidden': !computed.isNearLimit,
                  'bg-yellow-100 text-yellow-700 border border-yellow-200': computed.isNearLimit
                }"
              >
                ⚡ Approaching character limit - <span live:text="state.maxLength - state.text.length">0</span> characters remaining.
              </div>
              <div
                class="text-sm p-2 rounded"
                live:class="{
                  'hidden': !computed.isHalfway,
                  'bg-green-100 text-green-700 border border-green-200': computed.isHalfway
                }"
              >
                ✅ Looking good! Plenty of room for more content.
              </div>
            </div>
          </div>
        </div>

        <!-- 8. Image Slideshow -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#image-slideshow" id="image-slideshow" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline">
            8. Image Slideshow
          </a>
          <div data-controller="live">
            <!-- State -->
            <input type="hidden" data-live-state="currentSlide" value="0" />

            <!-- Events -->
            <div
              data-action="keydown.left@document->live#update"
              data-live-update-param="state.currentSlide = Math.max(0, state.currentSlide - 1)"
            ></div>
            <div
              data-action="keydown.right@document->live#update"
              data-live-update-param="state.currentSlide = Math.min(computed.totalSlides - 1, state.currentSlide + 1)"
            ></div>

            <!-- Computed States -->
            <script type="text/template" data-live-computed="slides">
              [
                {
                  url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=400&fit=crop',
                  title: 'Mountain Vista',
                  description: 'Breathtaking mountain landscape at sunrise'
                },
                {
                  url: 'https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=800&h=400&fit=crop',
                  title: 'Lake Reflection',
                  description: 'Serene lake with perfect mountain reflections'
                },
                {
                  url: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800&h=400&fit=crop',
                  title: 'Forest Path',
                  description: 'Mystical forest trail in golden morning light'
                },
                {
                  url: 'https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800&h=400&fit=crop',
                  title: 'Ocean Sunset',
                  description: 'Dramatic sunset over calm ocean waters'
                }
              ]
            </script>
            <script type="text/template" data-live-computed="totalSlides">
              computed.slides.length
            </script>
            <script type="text/template" data-live-computed="currentSlideData">
              computed.slides[state.currentSlide]
            </script>
            <script type="text/template" data-live-computed="canGoPrevious">
              state.currentSlide > 0
            </script>
            <script type="text/template" data-live-computed="canGoNext">
              state.currentSlide < computed.totalSlides - 1
            </script>
            <script type="text/template" data-live-computed="slideCounter">
              `${state.currentSlide + 1} / ${computed.totalSlides}`
            </script>

            <!-- Main Slideshow Container -->
            <div class="relative bg-gray-100 rounded-lg overflow-hidden" style="height: 400px">
              <!-- Current Image -->
              <img
                live:attributes="{ src: computed.currentSlideData.url, alt: computed.currentSlideData.title }"
                class="w-full h-full object-cover transition-opacity duration-300"
              />

              <!-- Navigation Buttons -->
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = Math.max(0, state.currentSlide - 1)"
                live:disabled="!computed.canGoPrevious"
                class="absolute left-4 top-1/2 transform -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200"
                live:class="{
                  'bg-white/80 hover:bg-white/90 text-gray-800 shadow-lg': computed.canGoPrevious,
                  'bg-gray-300/50 text-gray-400 cursor-not-allowed': !computed.canGoPrevious
                }"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>

              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = Math.min(computed.totalSlides - 1, state.currentSlide + 1)"
                live:disabled="!computed.canGoNext"
                class="absolute right-4 top-1/2 transform -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200"
                live:class="{
                  'bg-white/80 hover:bg-white/90 text-gray-800 shadow-lg': computed.canGoNext,
                  'bg-gray-300/50 text-gray-400 cursor-not-allowed': !computed.canGoNext
                }"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <!-- Slide Counter -->
              <div class="absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm font-medium">
                <span live:text="computed.slideCounter">1 / 4</span>
              </div>
            </div>

            <!-- Slide Information -->
            <div class="mt-4 text-center">
              <h3 class="text-xl font-semibold text-gray-800" live:text="computed.currentSlideData.title">Mountain Vista</h3>
              <p class="text-gray-600 mt-1" live:text="computed.currentSlideData.description">Breathtaking mountain landscape at sunrise</p>
            </div>

            <!-- Dot Indicators -->
            <div class="flex justify-center space-x-2 mt-4">
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = 0"
                class="w-3 h-3 rounded-full transition-all duration-200"
                live:class="{
                  'bg-blue-600': state.currentSlide === 0,
                  'bg-gray-300 hover:bg-gray-400': state.currentSlide !== 0
                }"
                title="Slide 1"
              ></button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = 1"
                class="w-3 h-3 rounded-full transition-all duration-200"
                live:class="{
                  'bg-blue-600': state.currentSlide === 1,
                  'bg-gray-300 hover:bg-gray-400': state.currentSlide !== 1
                }"
                title="Slide 2"
              ></button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = 2"
                class="w-3 h-3 rounded-full transition-all duration-200"
                live:class="{
                  'bg-blue-600': state.currentSlide === 2,
                  'bg-gray-300 hover:bg-gray-400': state.currentSlide !== 2
                }"
                title="Slide 3"
              ></button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = 3"
                class="w-3 h-3 rounded-full transition-all duration-200"
                live:class="{
                  'bg-blue-600': state.currentSlide === 3,
                  'bg-gray-300 hover:bg-gray-400': state.currentSlide !== 3
                }"
                title="Slide 4"
              ></button>
            </div>

            <!-- Slideshow Controls -->
            <div class="mt-6 flex justify-center space-x-3">
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = 0"
                class="px-4 py-2 text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"
              >
                First
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = Math.floor(Math.random() * computed.totalSlides)"
                class="px-4 py-2 text-sm font-medium bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors"
              >
                Random
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.currentSlide = computed.totalSlides - 1"
                class="px-4 py-2 text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"
              >
                Last
              </button>
            </div>

            <!-- Help Text -->
            <div class="mt-4 text-sm text-gray-500 text-center">
              Use the arrow buttons, click the dots, or use the control buttons to navigate through the slideshow.
            </div>
          </div>
        </div>

        <!-- 9. Subdomain Input with Validation -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#subdomain-validation" id="subdomain-validation" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >9. Subdomain Input with Validation</a
          >
          <div data-controller="live">
            <script type="text/template" data-live-computed="containsDomain">
              state.subdomain.toLowerCase().includes('example.com')
            </script>
            <script type="text/template" data-live-computed="isEmpty">
              state.subdomain.length === 0
            </script>
            <script type="text/template" data-live-computed="isValid">
              state.subdomain.length > 0 && !computed.containsDomain && /^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$/.test(state.subdomain)
            </script>

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Enter your subdomain</label>
                <div class="relative">
                  <input
                    type="text"
                    placeholder="www"
                    value="www.example.com"
                    data-live-state="subdomain"
                    data-action="input->live#update"
                    live:class="{
                      'border-red-500 bg-red-50': !computed.isValid && !computed.isEmpty,
                      'border-green-500 bg-green-50': computed.isValid,
                      'border-gray-300': computed.isEmpty,
                    }"
                    class="w-full pl-3 pr-32 py-2 border rounded-lg transition-colors focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                  <div class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 text-sm font-medium">.example.com</div>
                </div>
              </div>

              <!-- Preview of full domain -->
              <div live:show="state.subdomain.length > 0" class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-600 mb-1">Your full domain will be:</div>
                <div
                  class="font-mono text-lg font-medium"
                  live:class="{
                    'text-red-600': computed.containsDomain,
                    'text-green-600': computed.isValid,
                    'text-gray-800': !computed.containsDomain && !computed.isValid
                  }"
                  live:text="state.subdomain + '.example.com'"
                >
                  .example.com
                </div>
              </div>

              <!-- Validation Messages -->
              <div class="space-y-2">
                <!-- Domain warning -->
                <div live:show="computed.containsDomain" class="flex items-start space-x-2 p-3 bg-red-100 border border-red-200 rounded-lg">
                  <svg class="w-5 h-5 text-red-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <div class="text-sm text-red-700">
                    <div class="font-medium">Domain name detected!</div>
                    <div>Please enter only the subdomain part (without "example.com")</div>
                  </div>
                </div>

                <!-- Success message -->
                <div live:show="computed.isValid" class="flex items-start space-x-2 p-3 bg-green-100 border border-green-200 rounded-lg">
                  <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <div class="text-sm text-green-700">
                    <div class="font-medium">Valid subdomain!</div>
                    <div>Your subdomain is properly formatted and available to use.</div>
                  </div>
                </div>

                <!-- Invalid format message -->
                <div
                  live:show="state.subdomain.length > 0 && !computed.containsDomain && !computed.isValid"
                  class="flex items-start space-x-2 p-3 bg-yellow-100 border border-yellow-200 rounded-lg"
                >
                  <svg class="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <div class="text-sm text-yellow-700">
                    <div class="font-medium">Invalid format</div>
                    <div>Subdomains can only contain letters, numbers, and hyphens. They cannot start or end with a hyphen.</div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="flex gap-3 pt-2">
                <button
                  class="px-4 py-2 rounded-lg font-medium transition-all duration-150"
                  live:class="{
                    'bg-blue-600 hover:bg-blue-700 text-white cursor-pointer': computed.isValid,
                    'bg-gray-300 text-gray-500 cursor-not-allowed': !computed.isValid
                  }"
                  live:disabled="!computed.isValid"
                >
                  Create Subdomain
                </button>
                <button
                  data-action="click->live#update"
                  data-live-update-param="state.subdomain = ''"
                  class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 10. User Management (Advanced Filtering) -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#user-management" id="user-management" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >10. User Management (Advanced Filtering)</a
          >
          <div data-controller="live">
            <!-- Initial data -->
            <script type="text/template" data-live-computed="users">
              [
                { name: 'Alice', role: 'admin', active: true, score: 91 },
                { name: 'Bob', role: 'user', active: false, score: 78 },
                { name: 'Charlie', role: 'moderator', active: true, score: 88 },
                { name: 'Diana', role: 'user', active: true, score: 98 }
              ]
            </script>

            <!-- Computed States Templates -->
            <script type="text/template" data-live-computed="classifyScore">
              (score) => {
                if (score >= 90) return { level: 'excellent', color: 'text-green-600', label: 'Excellent' };
                if (score >= 80) return { level: 'good', color: 'text-blue-600', label: 'Good' };
                return { level: 'needs-improvement', color: 'text-yellow-600', label: 'Needs Improvement' };
              }
            </script>
            <script type="text/template" data-live-computed="filteredUsers">
              computed.users.filter(user => {
                // Role filter
                const roleMatch = state.role === 'all' ||
                  (state.role === 'admin-moderator' && (user.role === 'admin' || user.role === 'moderator')) ||
                  (state.role === 'user' && user.role === 'user');

                // Score filter
                const userScoreLevel = computed.classifyScore(user.score).level;
                const scoreMatch = state.scoreFilter === 'all' || state.scoreFilter === userScoreLevel;

                return roleMatch && scoreMatch;
              })
            </script>
            <script type="text/template" data-live-computed="sortedUsers">
              [...computed.filteredUsers].sort((a, b) => {
                if (state.sortBy === 'score') {
                  return b.score - a.score; // Sort by score descending
                }
                // Default: sort by name ascending
                return a.name.localeCompare(b.name);
              })
            </script>
            <script type="text/template" data-live-computed="usersHtml">
              computed.sortedUsers.map(user => {
                const statusColor = user.active ? 'bg-green-500' : 'bg-red-500';
                const scoreInfo = computed.classifyScore(user.score);

                return `
                  <div class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50">
                    <div class="flex items-center space-x-3">
                      <div class="w-3 h-3 ${statusColor} rounded-full"></div>
                      <div>
                        <div class="font-medium">${user.name}</div>
                        <div class="text-sm text-gray-500 capitalize">${user.role}</div>
                      </div>
                    </div>
                    <div class="flex items-center space-x-4">
                      <div class="text-right">
                        <div class="text-sm font-medium">Score: ${user.score}</div>
                        <span class="text-xs ${scoreInfo.color} font-medium">${scoreInfo.label}</span>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')
            </script>

            <!-- Controls -->
            <div class="grid grid-cols-3 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                <select
                  value="all"
                  data-live-state="role"
                  data-action="change->live#update"
                  class="w-full p-2 border border-gray-300 rounded"
                >
                  <option value="all">All</option>
                  <option value="admin-moderator">Admin / Moderator</option>
                  <option value="user">User</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Score</label>
                <select
                  value="all"
                  data-live-state="scoreFilter"
                  data-action="change->live#update"
                  class="w-full p-2 border border-gray-300 rounded"
                >
                  <option value="all">All Scores</option>
                  <option value="excellent">Excellent (90+)</option>
                  <option value="good">Good (80-89)</option>
                  <option value="needs-improvement">Needs Improvement (&lt;80)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                <select
                  value="name"
                  data-live-state="sortBy"
                  data-action="change->live#update"
                  class="w-full p-2 border border-gray-300 rounded"
                >
                  <option value="name">Name (A-Z)</option>
                  <option value="score">Score (High-Low)</option>
                </select>
              </div>
            </div>

            <!-- No users message -->
            <div live:show="computed.sortedUsers.length === 0" class="text-center py-8 text-gray-500">
              <p>No users match the current filters</p>
            </div>

            <!-- User List -->
            <div class="space-y-2" live:html="computed.usersHtml"></div>
          </div>
        </div>

        <!-- 11. Travel Booking Form (Dependent Dropdowns) -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#travel-booking" id="travel-booking" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline">
            11. Travel Booking Form (Dependent Dropdowns)
          </a>
          <div data-controller="live">
            <!-- Initial data -->
            <script type="text/template" data-live-computed="countries">
              {
                'usa': { name: 'United States', cities: ['New York', 'Los Angeles', 'Chicago', 'Miami', 'San Francisco'] },
                'france': { name: 'France', cities: ['Paris', 'Lyon', 'Marseille', 'Nice', 'Bordeaux'] },
                'japan': { name: 'Japan', cities: ['Tokyo', 'Osaka', 'Kyoto', 'Hiroshima', 'Sapporo'] },
                'italy': { name: 'Italy', cities: ['Rome', 'Milan', 'Venice', 'Florence', 'Naples'] },
                'australia': { name: 'Australia', cities: ['Sydney', 'Melbourne', 'Brisbane', 'Perth', 'Adelaide'] }
              }
            </script>

            <!-- Computed States Templates -->
            <script type="text/template" data-live-computed="selectedCountryData">
              state.country ? computed.countries[state.country] : null
            </script>
            <script type="text/template" data-live-computed="availableCities">
              computed.selectedCountryData ? computed.selectedCountryData.cities : []
            </script>
            <script type="text/template" data-live-computed="cityOptionsHtml">
              `<option value="">Select a city...</option>` + computed.availableCities.map(city =>
                `<option value="${city}" ${state.city === city ? 'selected' : ''}>${city}</option>`
              ).join('')
            </script>
            <script type="text/template" data-live-computed="hasSelection">
              state.country && state.city
            </script>
            <script type="text/template" data-live-computed="estimatedPrice">
              computed.hasSelection ? Math.floor(Math.random() * 800) + 400 : 0
            </script>
            <script type="text/template" data-live-computed="totalPrice">
              computed.estimatedPrice * state.travelers * (state.tripType === 'roundtrip' ? 1 : 0.6)
            </script>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Country Selection -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="flex items-center">
                    Destination Country
                    <span class="ml-1 text-red-500">*</span>
                  </span>
                </label>
                <select
                  value="usa"
                  data-live-state="country"
                  data-action="change->live#update"
                  data-live-update-param="state.city = ''"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="">Select a country...</option>
                  <option value="usa">🇺🇸 United States</option>
                  <option value="france">🇫🇷 France</option>
                  <option value="japan">🇯🇵 Japan</option>
                  <option value="italy">🇮🇹 Italy</option>
                  <option value="australia">🇦🇺 Australia</option>
                </select>
              </div>

              <!-- City Selection (Dependent on Country) -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="flex items-center">
                    Destination City
                    <span class="ml-1 text-red-500">*</span>
                  </span>
                </label>
                <select
                  value=""
                  data-live-state="city"
                  data-action="change->live#update"
                  live:disabled="!state.country"
                  live:html="computed.cityOptionsHtml"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
                >
                  <option value="">Select a city...</option>
                </select>
                <div live:show="!state.country" class="text-xs text-gray-500 mt-1">Please select a country first</div>
              </div>

              <!-- Number of Travelers -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Number of Travelers </label>
                <select
                  value="1"
                  data-live-state="travelers"
                  data-action="change->live#update"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="1">1 Traveler</option>
                  <option value="2">2 Travelers</option>
                  <option value="3">3 Travelers</option>
                  <option value="4">4 Travelers</option>
                  <option value="5">5+ Travelers</option>
                </select>
              </div>

              <!-- Trip Type -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Trip Type </label>
                <select
                  value="roundtrip"
                  data-live-state="tripType"
                  data-action="change->live#update"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="roundtrip">Round Trip</option>
                  <option value="oneway">One Way</option>
                </select>
              </div>
            </div>

            <!-- Selected Destination Preview -->
            <div
              live:show="computed.hasSelection"
              class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200"
            >
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Your Selected Destination</h3>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="font-medium text-gray-600">Country:</span>
                  <span
                    live:text="computed.selectedCountryData ? computed.selectedCountryData.name : ''"
                    class="ml-2 font-semibold text-blue-700"
                  ></span>
                </div>
                <div>
                  <span class="font-medium text-gray-600">City:</span>
                  <span live:text="state.city" class="ml-2 font-semibold text-blue-700"></span>
                </div>
                <div>
                  <span class="font-medium text-gray-600">Travelers:</span>
                  <span
                    live:text="state.travelers + (state.travelers === 1 ? ' person' : ' people')"
                    class="ml-2 font-semibold text-blue-700"
                  ></span>
                </div>
                <div>
                  <span class="font-medium text-gray-600">Trip Type:</span>
                  <span
                    live:text="state.tripType === 'roundtrip' ? 'Round Trip' : 'One Way'"
                    class="ml-2 font-semibold text-blue-700"
                  ></span>
                </div>
              </div>
            </div>

            <!-- Price Estimation -->
            <div live:show="computed.hasSelection" class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">Price Estimation</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Base price per person:</span>
                  <span live:text="'$' + computed.estimatedPrice" class="font-medium text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Number of travelers:</span>
                  <span live:text="state.travelers + 'x'" class="font-medium text-gray-800"></span>
                </div>
                <div live:show="state.tripType === 'oneway'" class="flex justify-between items-center">
                  <span class="text-gray-600">One-way discount:</span>
                  <span class="font-medium text-green-600">-40%</span>
                </div>
                <div class="border-t border-green-300 pt-2 mt-2">
                  <div class="flex justify-between items-center">
                    <span class="font-semibold text-gray-800">Total estimated price:</span>
                    <span live:text="'$' + Math.round(computed.totalPrice)" class="text-xl font-bold text-green-700"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Helpful Information -->
            <div live:show="state.country && !state.city" class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div class="flex items-start space-x-2">
                <svg class="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                <div class="text-sm text-yellow-800">
                  <div class="font-medium">Almost there!</div>
                  <div>
                    Please select a city in
                    <span live:text="computed.selectedCountryData ? computed.selectedCountryData.name : ''" class="font-semibold"></span>
                    to see pricing information.
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mt-6">
              <button
                class="flex-1 py-3 px-6 rounded-lg font-medium transition-all duration-150"
                live:class="{
                  'bg-blue-600 hover:bg-blue-700 text-white cursor-pointer': computed.hasSelection,
                  'bg-gray-300 text-gray-500 cursor-not-allowed': !computed.hasSelection
                }"
                live:disabled="!computed.hasSelection"
              >
                Search Flights
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.country = 'usa', state.city = '', state.travelers = 1, state.tripType = 'roundtrip'"
                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Reset Form
              </button>
            </div>
          </div>
        </div>

        <!-- 12. Terms & Conditions Agreement -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#terms-agreement" id="terms-agreement" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline"
            >12. Terms & Conditions Agreement</a
          >
          <div data-controller="live">
            <!-- Computed States Templates -->
            <script type="text/template" data-live-computed="isValidEmail">
              state.email && state.email.includes('@') && state.email.length > 5
            </script>
            <script type="text/template" data-live-computed="allRequirementsMet">
              state.acceptTerms && state.acceptPrivacy && computed.isValidEmail
            </script>

            <!-- Email Input -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
              <input
                type="email"
                placeholder="Enter your email address"
                value=""
                data-live-state="email"
                data-action="input->live#update"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              />
            </div>

            <!-- Terms and Conditions Checkbox -->
            <div class="space-y-4">
              <label class="flex items-start space-x-3 cursor-pointer">
                <input
                  type="checkbox"
                  data-live-state="acceptTerms"
                  data-action="change->live#update"
                  class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <div class="text-sm">
                  <span class="text-gray-700">I agree to the </span>
                  <a href="#" class="text-blue-600 hover:text-blue-800 underline">Terms and Conditions</a>
                  <span class="text-gray-700"> and understand that my account will be subject to the platform rules and guidelines.</span>
                </div>
              </label>

              <!-- Privacy Policy Checkbox -->
              <label class="flex items-start space-x-3 cursor-pointer">
                <input
                  type="checkbox"
                  data-live-state="acceptPrivacy"
                  data-action="change->live#update"
                  class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <div class="text-sm">
                  <span class="text-gray-700">I have read and accept the </span>
                  <a href="#" class="text-blue-600 hover:text-blue-800 underline">Privacy Policy</a>
                  <span class="text-gray-700"> and consent to the collection and use of my personal data as described.</span>
                </div>
              </label>
            </div>

            <!-- Status Indicators -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
              <h3 class="text-sm font-medium text-gray-700 mb-3">Requirements Status:</h3>
              <div class="space-y-2 text-sm">
                <div class="flex items-center space-x-2">
                  <div
                    class="w-4 h-4 rounded-full flex items-center justify-center"
                    live:class="{
                      'bg-green-500': computed.isValidEmail,
                      'bg-red-500': !computed.isValidEmail
                    }"
                  >
                    <span class="text-xs text-white font-bold" live:text="computed.isValidEmail ? '✓' : '✗'">✗</span>
                  </div>
                  <span class="text-gray-600">Valid email address</span>
                </div>
                <div class="flex items-center space-x-2">
                  <div
                    class="w-4 h-4 rounded-full flex items-center justify-center"
                    live:class="{
                      'bg-green-500': state.acceptTerms,
                      'bg-red-500': !state.acceptTerms
                    }"
                  >
                    <span class="text-xs text-white font-bold" live:text="state.acceptTerms ? '✓' : '✗'">✗</span>
                  </div>
                  <span class="text-gray-600">Terms and Conditions accepted</span>
                </div>
                <div class="flex items-center space-x-2">
                  <div
                    class="w-4 h-4 rounded-full flex items-center justify-center"
                    live:class="{
                      'bg-green-500': state.acceptPrivacy,
                      'bg-red-500': !state.acceptPrivacy
                    }"
                  >
                    <span class="text-xs text-white font-bold" live:text="state.acceptPrivacy ? '✓' : '✗'">✗</span>
                  </div>
                  <span class="text-gray-600">Privacy Policy accepted</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mt-6">
              <button
                class="flex-1 py-3 px-6 rounded-lg font-medium transition-all duration-150"
                live:class="{
                  'bg-blue-600 hover:bg-blue-700 text-white cursor-pointer': computed.allRequirementsMet,
                  'bg-gray-300 text-gray-500 cursor-not-allowed': !computed.allRequirementsMet
                }"
                live:text="computed.allRequirementsMet ? 'Create Account' : 'Complete Requirements'"
              >
                Complete Requirements
              </button>
              <button
                data-action="click->live#update"
                data-live-update-param="state.acceptTerms = false, state.acceptPrivacy = false, state.email = ''"
                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
            </div>

            <!-- Progress Indicator -->
            <div class="mt-4">
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Completion Progress:</span>
                <span
                  class="text-sm font-bold"
                  live:class="{
                    'text-green-600': computed.allRequirementsMet,
                    'text-blue-600': !computed.allRequirementsMet
                  }"
                  live:text="Math.round(((state.acceptTerms ? 1 : 0) + (state.acceptPrivacy ? 1 : 0) + (computed.isValidEmail ? 1 : 0)) / 3 * 100) + '%'"
                >
                  0%
                </span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div
                  class="h-2 rounded-full transition-all duration-150"
                  live:class="{
                    'bg-green-500': computed.allRequirementsMet,
                    'bg-blue-500': !computed.allRequirementsMet
                  }"
                  live:style="{ width: Math.round(((state.acceptTerms ? 1 : 0) + (state.acceptPrivacy ? 1 : 0) + (computed.isValidEmail ? 1 : 0)) / 3 * 100) + '%' }"
                ></div>
              </div>
            </div>

            <!-- Help Text -->
            <div class="mt-4 text-sm text-gray-600">
              <p live:class="{ 'hidden': computed.allRequirementsMet }">Please complete all requirements above to create your account.</p>
              <p class="text-green-600 font-medium" live:class="{ 'hidden': !computed.allRequirementsMet }">
                ✅ All requirements met! You can now create your account.
              </p>
            </div>
          </div>
        </div>

        <!-- 13. Modal Component -->
        <div class="bg-white rounded-lg shadow-md p-6 space-y-4">
          <a href="#modal-component" id="modal-component" class="text-xl font-semibold text-gray-700 scroll-mt-12 hover:underline">
            13. Modal Component with Live Template
          </a>
          <div data-controller="modal live">
            <!-- State for modal content -->
            <input type="hidden" data-live-state="modalType" value="info" />

            <!-- Buttons that change modal content -->
            <div class="space-x-3 mb-4">
              <button
                data-action="click->live#update click->modal#open"
                data-live-update-param="state.modalType = 'info'"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
              >
                Open Info Modal
              </button>
              <button
                data-action="click->live#update click->modal#open"
                data-live-update-param="state.modalType = 'warning'"
                class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded"
              >
                Open Warning Modal
              </button>
              <button
                data-action="click->live#update click->modal#open"
                data-live-update-param="state.modalType = 'success'"
                class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
              >
                Open Success Modal
              </button>
            </div>

            <!-- Computed content based on modal type -->
            <script type="text/template" data-live-computed="modalContent">
              state.modalType === 'info' ?
                `<div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50" data-action="click->modal#close">
                   <div class="bg-white rounded-lg shadow-xl p-6 w-1/2 max-w-md" data-action="click->modal#stopPropagation">
                     <h2 class="text-xl font-bold mb-4 text-blue-600">📘 Information Modal</h2>
                     <p class="text-gray-700 mb-4">This is an informational modal. Here you can display helpful information to your users.</p>
                     <div class="bg-blue-50 p-3 rounded mb-4">
                       <p class="text-blue-800 text-sm">💡 Tip: Information modals are great for providing context and guidance.</p>
                     </div>
                     <div class="mt-4 flex justify-end">
                       <button data-action="click->modal#close" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                         Close
                       </button>
                     </div>
                   </div>
                 </div>` :
              state.modalType === 'warning' ?
                `<div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50" data-action="click->modal#close">
                   <div class="bg-white rounded-lg shadow-xl p-6 w-1/2 max-w-md" data-action="click->modal#stopPropagation">
                     <h2 class="text-xl font-bold mb-4 text-yellow-600">⚠️ Warning Modal</h2>
                     <p class="text-gray-700 mb-4">This is a warning modal. Use this to alert users about important information.</p>
                     <div class="bg-yellow-50 p-3 rounded mb-4">
                       <p class="text-yellow-800 text-sm">⚠️ Warning: Please review your actions before proceeding.</p>
                     </div>
                     <div class="mt-4 flex justify-end">
                       <button data-action="click->modal#close" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                         Close
                       </button>
                     </div>
                   </div>
                 </div>` :
                `<div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50" data-action="click->modal#close">
                   <div class="bg-white rounded-lg shadow-xl p-6 w-1/2 max-w-md" data-action="click->modal#stopPropagation">
                     <h2 class="text-xl font-bold mb-4 text-green-600">✅ Success Modal</h2>
                     <p class="text-gray-700 mb-4">This is a success modal. Perfect for confirming completed actions.</p>
                     <div class="bg-green-50 p-3 rounded mb-4">
                       <p class="text-green-800 text-sm">🎉 Success: Your action was completed successfully!</p>
                     </div>
                     <div class="mt-4 flex justify-end">
                       <button data-action="click->modal#close" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                         Close
                       </button>
                     </div>
                   </div>
                 </div>`
            </script>

            <template data-modal-target="template" live:html="computed.modalContent"> </template>

            <!-- Current state display -->
            <div class="mt-4 p-3 bg-gray-50 rounded">
              <p class="text-sm text-gray-600">Current modal type: <span class="font-semibold" live:text="state.modalType">info</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { Application, Controller } from '@hotwired/stimulus';

      class LiveState {
        constructor(element) {
          this.element = element;
          this.name = element.dataset.liveState;
        }

        get processFunctionName() {
          return `processLive${toTitleCase(this.element.tagName)}State`;
        }

        toString() {
          return `LiveState(${this.name})`;
        }
      }

      export class LiveComputed {
        constructor(element) {
          this.element = element;
          this.name = element.dataset.liveComputed;
        }

        get processFunctionName() {
          return `processLive${toTitleCase(this.element.tagName)}Computed`;
        }

        toString() {
          return `LiveComputed(${this.element.tagName}, ${this.name})`;
        }
      }

      class LiveAttribute {
        constructor(attributeNode) {
          this.element = attributeNode.ownerElement;
          this.name = attributeNode.name;
          this.expression = attributeNode.value;
        }

        get processFunctionName() {
          return `processLive${toTitleCase(this.name.replace('live:', ''))}Attribute`;
        }

        toString() {
          return `LiveAttribute(${this.name}, ${this.expression})`;
        }
      }

      class LiveObserver extends MutationObserver {
        constructor(element, callback) {
          super(callback);
          this.element = element;
        }

        connect() {
          this.observe(this.element, { attributes: true, childList: true, subtree: true });
        }

        paused(callback) {
          try {
            this.disconnect();
            callback();
          } finally {
            this.connect();
          }
        }
      }

      function toTitleCase(string) {
        return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
      }

      function typecast(value) {
        try {
          return JSON.parse(value);
        } catch (_error) {
          return value;
        }
      }

      class LiveController extends Controller {
        connect() {
          this.state = {};
          this.computed = {};

          this.observer = new LiveObserver(this.element, (mutations) => {
            this.collectLiveComputeds();
            this.processLiveComputeds();
            this.collectLiveAttributes();
            this.processLiveAttributes();
          });

          this.collectLiveStates();
          this.processLiveStates();

          this.collectLiveComputeds();
          this.processLiveComputeds();

          this.collectLiveAttributes();
          this.processLiveAttributes();

          this.observer.connect();
        }

        get liveAttributeAttributeNames() {
          return ['live:text', 'live:html', 'live:class', 'live:style', 'live:show', 'live:disabled', 'live:attributes'];
        }

        collectLiveStates() {
          this.liveStates = this.queryElementsByAttribute('data-live-state').map((element) => new LiveState(element));
        }

        collectLiveComputeds() {
          this.liveComputed = this.queryElementsByAttribute('data-live-computed').map((element) => new LiveComputed(element));
        }

        collectLiveAttributes() {
          this.liveAttributes = this.liveAttributeAttributeNames.flatMap((attributeName) => {
            return this.queryElementsByAttribute(attributeName).map((element) => {
              const attributeNode = element.getAttributeNode(attributeName);
              return new LiveAttribute(attributeNode);
            });
          });
        }

        processLiveStates() {
          this.liveStates.forEach(this.processLiveState.bind(this));
        }

        processLiveState(liveState) {
          const functionName = liveState.processFunctionName;

          if (typeof this[functionName] !== 'function') {
            console.warn(`Could not find state define function ${functionName} for ${liveState}`);
            return;
          }

          this[functionName](liveState);
        }

        processLiveInputState({ element, name }) {
          this.defineLiveState(name, {
            get: () => this.getInputValue({ element, name }),
            set: (value) => this.setInputValue({ element, name }, value),
          });
        }

        processLiveTextareaState({ element, name }) {
          this.defineLiveState(name, { get: () => element.value, set: (value) => (element.value = value) });
        }

        processLiveSelectState({ element, name }) {
          this.defineLiveState(name, { get: () => element.value, set: (value) => (element.value = value) });
        }

        processLiveComputeds() {
          this.liveComputed.forEach(this.processLiveComputed.bind(this));
        }

        processLiveComputed(liveComputed) {
          const functionName = liveComputed.processFunctionName;

          if (typeof this[functionName] !== 'function') {
            console.warn(`${liveComputed} is not supported yet, please implement ${functionName}`);
            return;
          }

          this[functionName](liveComputed);
        }

        processLiveScriptComputed({ element, name }) {
          const expression = element.textContent.trim();

          // Check if the expression starts with '<' (HTML content)
          const isHtmlExpression = expression.startsWith('<');

          // If it's HTML, wrap it in backticks for template literal evaluation
          const finalExpression = isHtmlExpression ? `\`${expression}\`` : expression;

          this.defineLiveComputed(name, { get: () => this.evaluateExpression(finalExpression) });
        }

        processLiveAttributes() {
          this.liveAttributes.forEach(this.processLiveAttribute.bind(this));
        }

        processLiveAttribute(liveAttribute) {
          const functionName = liveAttribute.processFunctionName;

          if (typeof this[functionName] !== 'function') {
            console.warn(`Could not find binding function ${functionName} for ${liveAttribute}`);
            return;
          }

          this[functionName](liveAttribute, this.evaluateExpression(liveAttribute.expression));
        }

        processLiveTextAttribute({ element }, result) {
          this.observer.paused(() => (element.textContent = result));
        }

        processLiveHtmlAttribute({ element }, result) {
          this.observer.paused(() => (element.innerHTML = result));
        }

        processLiveClassAttribute({ element }, result) {
          Object.keys(result).forEach((classNames) => this.toggleClasses(element, classNames, result[classNames]));
        }

        processLiveStyleAttribute({ element }, result) {
          Object.keys(result).forEach((property) => {
            this.observer.paused(() => (element.style[property] = result[property]));
          });
        }

        processLiveShowAttribute({ element }, result) {
          this.observer.paused(() => (element.style.display = result ? '' : 'none'));
        }

        processLiveDisabledAttribute({ element }, result) {
          this.observer.paused(() => (element.disabled = result));
        }

        processLiveAttributesAttribute({ element }, result) {
          Object.keys(result).forEach((attrName) => {
            const value = result[attrName];
            this.observer.paused(() => {
              if (value === null || value === undefined || value === false) {
                element.removeAttribute(attrName);
              } else if (value === true) {
                element.setAttribute(attrName, '');
              } else {
                element.setAttribute(attrName, value);
              }
            });
          });
        }

        update(event) {
          this.evaluateExpression(event.params.update);
          this.processLiveAttributes();
        }

        disconnect() {
          this.observer.disconnect();
        }

        queryElementsByAttribute(attributeName) {
          return Array.from(this.element.querySelectorAll(`[${attributeName.replace(':', '\\:')}]`));
        }

        defineLiveState(name, descriptor) {
          Object.defineProperty(this.state, name, { configurable: true, enumerable: true, ...descriptor });
        }

        defineLiveComputed(name, descriptor) {
          Object.defineProperty(this.computed, name, { configurable: true, enumerable: true, ...descriptor });
        }

        evaluateExpression(expression) {
          try {
            return new Function('state', 'computed', `return ${expression};`)(this.state, this.computed);
          } catch (error) {
            console.error(`Error evaluating expression "${expression}":`, error);
            return null;
          }
        }

        toggleClasses(element, classNames, isToggled) {
          classNames.split(/\s+/).forEach((className) => this.observer.paused(() => element.classList.toggle(className.trim(), isToggled)));
        }

        getInputValue({ element, name }) {
          if (element.type === 'checkbox') {
            return element.checked;
          } else if (element.type === 'radio') {
            return this.element.querySelector(`input[name="${name}"]:checked`)?.value || '';
          }

          return typecast(element.value);
        }

        setInputValue({ element, name }, value) {
          if (element.type === 'checkbox') {
            element.checked = value;
          } else if (element.type === 'radio') {
            // For radio buttons, find the radio button with the matching value and check it
            const radioButton = this.element.querySelector(`input[name="${name}"][value="${value}"]`);
            if (radioButton) {
              radioButton.checked = true;
            }
          } else {
            element.value = value;
          }
        }
      }

      class ModalController extends Controller {
        static targets = ['template'];

        open() {
          if (this.modal) return; // Prevent multiple modals

          this.modal = this.templateTarget.content.cloneNode(true).firstElementChild;

          // Add event listeners to the modal
          this.modal.addEventListener('click', this.handleBackdropClick.bind(this));
          const modalContent = this.modal.querySelector('[data-action*="stopPropagation"]');
          if (modalContent) {
            modalContent.addEventListener('click', this.stopPropagation.bind(this));
          }

          const closeButtons = this.modal.querySelectorAll('[data-action*="modal#close"]');
          closeButtons.forEach((button) => {
            button.addEventListener('click', this.close.bind(this));
          });

          // Add escape key listener
          this.escapeHandler = this.handleEscape.bind(this);
          document.addEventListener('keydown', this.escapeHandler);

          document.body.appendChild(this.modal);
        }

        close() {
          if (this.modal) {
            this.modal.remove();
            this.modal = null;
          }

          if (this.escapeHandler) {
            document.removeEventListener('keydown', this.escapeHandler);
            this.escapeHandler = null;
          }
        }

        handleBackdropClick(event) {
          if (event.target === this.modal) {
            this.close();
          }
        }

        handleEscape(event) {
          if (event.key === 'Escape') {
            this.close();
          }
        }

        stopPropagation(event) {
          event.stopPropagation();
        }

        disconnect() {
          this.close();
        }
      }

      const application = Application.start();
      application.register('live', LiveController);
      application.register('modal', ModalController);
    </script>
  </body>
</html>
